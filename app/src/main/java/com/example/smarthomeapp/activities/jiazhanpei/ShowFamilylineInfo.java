package com.example.smarthomeapp.activities.jiazhanpei;import android.app.Activity;import android.os.Bundle;import android.os.Handler;import android.view.View;import android.widget.ExpandableListView;import com.example.smarthomeapp.R;import com.example.smarthomeapp.listener.HttpResultProcessListener;import com.example.smarthomeapp.model.ElectricityInfo;import com.example.smarthomeapp.result_jzp.MeterQueryResolver;import com.example.smarthomeapp.util.GsonUtil;import com.google.gson.Gson;import com.example.smarthomeapp.adapter.jia.LineExpandableListAdapter;import java.util.HashSet;/** * Created by 卧龙风 on 2015/7/20. */public class ShowFamilylineInfo extends Activity {    private static final int TIME=5000;    private boolean flag;    private LineExpandableListAdapter lineExpandableListAdapter;    private int[] group_checked = new int[]{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};    class MyHttpResultProcessListener implements HttpResultProcessListener {        @Override        public void processing(int status, String responsString) {            Gson gson= GsonUtil.create();            ElectricityInfo[] electricityInfos = gson.fromJson(responsString,ElectricityInfo[].class);            lineExpandableListAdapter.setFamilyline_value(electricityInfos);            lineExpandableListAdapter.notifyDataSetChanged();        }    }    HashSet<Integer> ids;    Handler handler = new Handler();    Runnable runnable = new Runnable() {        @Override        public void run() {            // handler自带方法实现定时器            try {                if (flag) {                    handler.postDelayed(this, TIME);                    ids = new HashSet<Integer>();                    ids.add(1);                    ids.add(2);                    ids.add(3);                    MeterQueryResolver.queryMeterData(getBaseContext(),ids,new MyHttpResultProcessListener());                }            } catch (Exception e) {            }        }    };    @Override    protected void onCreate(Bundle savedInstanceState){        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_ui_familyline);        final ExpandableListView expandableListView = (ExpandableListView)findViewById(                R.id.familyline_expandableListView);        lineExpandableListAdapter = new LineExpandableListAdapter(this);        expandableListView.setAdapter(lineExpandableListAdapter);        expandableListView.setGroupIndicator(null);        expandableListView.setOnGroupClickListener(new ExpandableListView.OnGroupClickListener() {            @Override            public boolean onGroupClick(ExpandableListView parent, View v, int groupPosition, long id) {                group_checked[groupPosition] = group_checked[groupPosition] + 1;                lineExpandableListAdapter.notifyDataSetChanged();                return false;            }        });        expandableListView.setOnChildClickListener(new ExpandableListView.OnChildClickListener() {            @Override            public boolean onChildClick(ExpandableListView parent, View v, int groupPosition, int childPosition, long id) {                 int childGroupId = -1;                 int childChildId = -1;                childGroupId = groupPosition;                childChildId = childPosition;                lineExpandableListAdapter .notifyDataSetChanged();                return false;            }        });    }    @Override    public void onResume() {        super.onResume();        flag = true;        handler.postDelayed(runnable, 0);    }    @Override    public void onPause() {        super.onPause();        flag = false;    }}